import streamlit as st
import pandas as pd
import plotly.express as px

# CSV íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
df = pd.read_csv("ìƒì‚°ìë¬¼ê°€ì§€ìˆ˜_ê¸°ë³¸ë¶„ë¥˜__20250725131239.csv", encoding="euc-kr")

# ë°ì´í„° ì „ì²˜ë¦¬
df = df.melt(id_vars=['ê³„ì •ì½”ë“œë³„'], var_name='ì›”', value_name='ì§€ìˆ˜')
df = df.drop_duplicates()

# ì§€ìˆ˜ ìˆ«ìí˜• ë³€í™˜
df['ì§€ìˆ˜'] = pd.to_numeric(df['ì§€ìˆ˜'], errors='coerce')

# '2025.01' -> '01' í˜•íƒœë¡œ ê°€ê³µ
df['ì›”'] = df['ì›”'].str.split('.').str[1]

# Streamlit UI
st.title("ğŸ“Š ìƒì‚°ìë¬¼ê°€ì§€ìˆ˜ ì‹œê°í™”")

# ğŸ“˜ ìš”ì•½ ì„¤ëª… ì¶”ê°€
with st.expander("ğŸ“˜ ìƒì‚°ìë¬¼ê°€ì§€ìˆ˜(PPI)ë€?"):
    st.markdown("""
    **ìƒì‚°ìë¬¼ê°€ì§€ìˆ˜(PPI)**ëŠ” êµ­ë‚´ ìƒì‚°ìê°€ ìƒí’ˆì´ë‚˜ ì„œë¹„ìŠ¤ë¥¼ ë„ë§¤ì—…ì ë“±ì—ê²Œ íŒë§¤í•  ë•Œ ë°›ëŠ” **ì¶œê³ ê°€ê²©ì˜ í‰ê· ì ì¸ ë³€ë™ì„ ë‚˜íƒ€ë‚´ëŠ” ì§€í‘œ**ì…ë‹ˆë‹¤.

    ì´ ì§€ìˆ˜ëŠ” ì¼ë°˜ì ìœ¼ë¡œ **íŠ¹ì • ê¸°ì¤€ì—°ë„(ì˜ˆ: 2020ë…„)ì˜ ê°€ê²© ìˆ˜ì¤€ì„ 100ìœ¼ë¡œ ì„¤ì •**í•˜ê³ , ê·¸ ì´í›„ì˜ ê°€ê²© ë³€ë™ì„ ìƒëŒ€ì ìœ¼ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.  
    ì˜ˆë¥¼ ë“¤ì–´ PPIê°€ 120ì´ë¼ë©´, ê¸°ì¤€ì—°ë„ ëŒ€ë¹„ ìƒì‚°ì ê°€ê²©ì´ **ì•½ 20% ìƒìŠ¹**í•œ ê²ƒì…ë‹ˆë‹¤.

    PPIëŠ” ì†Œë¹„ì ì…ì¥ì´ ì•„ë‹Œ **ìƒì‚°ì ì…ì¥ì—ì„œ ë³¸ ë¬¼ê°€ì§€í‘œ**ë¡œ, ì¸í”Œë ˆì´ì…˜ ì˜ˆì¸¡ì´ë‚˜ ê¸ˆë¦¬ ê²°ì • ë“± ë‹¤ì–‘í•œ ê²½ì œì •ì±…ì— í™œìš©ë©ë‹ˆë‹¤.

    ë”°ë¼ì„œ ìƒì‚°ìë¬¼ê°€ì§€ìˆ˜ëŠ” ë‹¨ìˆœí•œ ìˆ«ìê°€ ì•„ë‹Œ, **ê²½ì œ íë¦„ì„ ì½ëŠ” ì¤‘ìš”í•œ ì‹ í˜¸**ì…ë‹ˆë‹¤.
    """)

# ê³„ì •ì½”ë“œë³„ ì„ íƒ
categories = df['ê³„ì •ì½”ë“œë³„'].unique()
selected_categories = st.multiselect("ğŸ“Œ ê³„ì •ì½”ë“œë³„ ì„ íƒ", categories, default=[categories[0]])

# ì„ íƒ í•„í„°ë§
filtered_df = df[df['ê³„ì •ì½”ë“œë³„'].isin(selected_categories)]

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ“Š 1. ë§‰ëŒ€ ê·¸ë˜í”„
fig_bar = px.bar(
    filtered_df,
    x='ì›”',
    y='ì§€ìˆ˜',
    color='ê³„ì •ì½”ë“œë³„',
    barmode='group',
    text=filtered_df['ì§€ìˆ˜'].round(2),
    title="ì›”ë³„ ìƒì‚°ìë¬¼ê°€ì§€ìˆ˜ (ë§‰ëŒ€ê·¸ë˜í”„)"
)
fig_bar.update_traces(textposition='outside')
fig_bar.update_layout(uniformtext_minsize=8, uniformtext_mode='hide')

# ê·¸ë˜í”„ ì¶œë ¥
st.plotly_chart(fig_bar, use_container_width=True)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ“ˆ 2. ì„  ê·¸ë˜í”„
fig_line = px.line(
    filtered_df,
    x='ì›”',
    y='ì§€ìˆ˜',
    color='ê³„ì •ì½”ë“œë³„',
    markers=True,
    title="ì›”ë³„ ìƒì‚°ìë¬¼ê°€ì§€ìˆ˜ (ì„ ê·¸ë˜í”„)"
)
fig_line.update_layout(yaxis_title="ì§€ìˆ˜", xaxis_title="ì›”")

# ê·¸ë˜í”„ ì¶œë ¥
st.plotly_chart(fig_line, use_container_width=True)
